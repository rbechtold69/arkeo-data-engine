<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arkeo Dashboard - Data Marketplace</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            arkeo: {
              DEFAULT: '#3be0ff',
              50: '#edfcff',
              100: '#d6f7ff',
              200: '#b5f2ff',
              300: '#83ebff',
              400: '#3be0ff',
              500: '#14c8eb',
              600: '#00a0c5',
              700: '#0080a0',
              800: '#066883',
              900: '#0b566d',
            },
            primary: '#FF2BCB',
            primaryMid: '#FF4FD2',
            primaryEnd: '#FF8A2B',
            secondary: '#3E4656',
            secondaryText: '#A9AFC0',
            surface: '#161A23',
            border: '#1E222C',
            background: '#0F121A',
          }
        }
      }
    }
  </script>
  <style>
    :root {
      --bg-main: #0F121A;
      --surface: #161A23;
      --border: #1E222C;
      --primary-1: #FF2BCB;
      --primary-2: #FF4FD2;
      --primary-3: #FF8A2B;
      --secondary-bg: #3E4656;
      --secondary-text: #A9AFC0;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; background: var(--bg-main); color: #e5e7eb; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .card-surface { background: var(--surface); border: 1px solid var(--border); }
    .primary-gradient { background: linear-gradient(90deg, var(--primary-1) 0%, var(--primary-2) 50%, var(--primary-3) 100%); }
    .primary-gradient:hover { filter: brightness(1.05); }
    .primary-shadow { box-shadow: 0 10px 30px rgba(255, 79, 210, 0.25); }
    .secondary-btn { background: var(--secondary-bg); color: var(--secondary-text); }
    .text-arkeo { --tw-text-opacity: 1; color: rgb(59 224 255 / var(--tw-text-opacity, 1)); }
    .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
    .backdrop-blur { --tw-backdrop-blur: blur(8px); -webkit-backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia); backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia); }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // ============================================================================
    // EXPANDED SERVICES - All supported chains
    // ============================================================================

    const SERVICES = [
      { id: 1, name: 'Arkeo', icon: 'âš¡' },
      { id: 2, name: 'Ethereum', icon: 'â—†' },
      { id: 3, name: 'Cosmos Hub', icon: 'âš›' },
      { id: 4, name: 'Osmosis', icon: 'ðŸ§ª' },
      { id: 5, name: 'Bitcoin', icon: 'â‚¿' },
      { id: 6, name: 'Base', icon: 'ðŸ”µ' },
      { id: 7, name: 'Solana', icon: 'â—Ž' },
      { id: 8, name: 'Avalanche', icon: 'ðŸ”º' },
      { id: 9, name: 'BNB Chain', icon: 'â¬¡' },
    ];

    // Location regions for filtering
    const REGIONS = [
      { id: 'all', name: 'All Regions', icon: 'ðŸŒ' },
      { id: 'na-east', name: 'North America - East', icon: 'ðŸ‡ºðŸ‡¸' },
      { id: 'na-west', name: 'North America - West', icon: 'ðŸ‡ºðŸ‡¸' },
      { id: 'eu-west', name: 'Europe - West', icon: 'ðŸ‡ªðŸ‡º' },
      { id: 'eu-central', name: 'Europe - Central', icon: 'ðŸ‡ªðŸ‡º' },
      { id: 'asia-east', name: 'Asia - East', icon: 'ðŸŒ' },
      { id: 'asia-south', name: 'Asia - Southeast', icon: 'ðŸŒ' },
      { id: 'oceania', name: 'Oceania', icon: 'ðŸ‡¦ðŸ‡º' },
      { id: 'sa', name: 'South America', icon: 'ðŸŒŽ' },
    ];

    // ============================================================================
    // MOCK DATA - With earnings history
    // ============================================================================

    const MOCK_PROVIDERS = [
      {
        id: 'p1',
        pubKey: 'arkeopub1addwnpepqg7xvkz3k5tq8snx4d3q',
        moniker: 'Red_5 Validator',
        description: 'High-performance multi-chain RPC infrastructure with 99.9% uptime guarantee',
        location: 'USA, East Coast',
        region: 'na-east',
        infrastructure: 'Bare Metal',
        status: 'ONLINE',
        totalContracts: 47,
        activeContracts: 12,
        uptime: 99.8,
        avgLatency: 45,
        reputation: 4.9,
        earnings: {
          daily: 1250000000,
          weekly: 8750000000,
          monthly: 35000000000,
        },
        services: [
          { id: 1, name: 'Arkeo', paygoRate: '1' },
          { id: 3, name: 'Cosmos Hub', paygoRate: '1' },
          { id: 5, name: 'Bitcoin', paygoRate: '2' },
        ],
      },
      {
        id: 'p2',
        pubKey: 'arkeopub1addwnpepqf8xvkz3k5tq8snx4d3r',
        moniker: 'Liquify Nodes',
        description: 'Enterprise-grade blockchain infrastructure serving institutions worldwide',
        location: 'Germany, Frankfurt',
        region: 'eu-central',
        infrastructure: 'AWS',
        status: 'ONLINE',
        totalContracts: 156,
        activeContracts: 34,
        uptime: 99.95,
        avgLatency: 32,
        reputation: 5.0,
        earnings: {
          daily: 4500000000,
          weekly: 31500000000,
          monthly: 126000000000,
        },
        services: [
          { id: 2, name: 'Ethereum', paygoRate: '5' },
          { id: 4, name: 'Osmosis', paygoRate: '2' },
          { id: 6, name: 'Base', paygoRate: '3' },
          { id: 8, name: 'Avalanche', paygoRate: '4' },
        ],
      },
      {
        id: 'p3',
        pubKey: 'arkeopub1addwnpepqh9xvkz3k5tq8snx4d3s',
        moniker: 'CosmosRPC Pro',
        description: 'Specialized Cosmos ecosystem RPC provider with global edge nodes',
        location: 'Singapore',
        region: 'asia-south',
        infrastructure: 'Google Cloud',
        status: 'ONLINE',
        totalContracts: 89,
        activeContracts: 21,
        uptime: 99.7,
        avgLatency: 28,
        reputation: 4.7,
        earnings: {
          daily: 2100000000,
          weekly: 14700000000,
          monthly: 58800000000,
        },
        services: [
          { id: 1, name: 'Arkeo', paygoRate: '1' },
          { id: 3, name: 'Cosmos Hub', paygoRate: '1' },
          { id: 4, name: 'Osmosis', paygoRate: '1' },
          { id: 7, name: 'Solana', paygoRate: '3' },
        ],
      },
      {
        id: 'p4',
        pubKey: 'arkeopub1addwnpepqi0xvkz3k5tq8snx4d3t',
        moniker: 'NodeStake',
        description: 'Professional validator and RPC services for 50+ blockchain networks',
        location: 'Netherlands',
        region: 'eu-west',
        infrastructure: 'Hetzner',
        status: 'ONLINE',
        totalContracts: 112,
        activeContracts: 28,
        uptime: 99.6,
        avgLatency: 38,
        reputation: 4.8,
        earnings: {
          daily: 3200000000,
          weekly: 22400000000,
          monthly: 89600000000,
        },
        services: [
          { id: 2, name: 'Ethereum', paygoRate: '4' },
          { id: 3, name: 'Cosmos Hub', paygoRate: '1' },
          { id: 9, name: 'BNB Chain', paygoRate: '2' },
          { id: 5, name: 'Bitcoin', paygoRate: '2' },
        ],
      },
      {
        id: 'p5',
        pubKey: 'arkeopub1addwnpepqj1xvkz3k5tq8snx4d3u',
        moniker: 'Pacific Nodes',
        description: 'Low-latency RPC endpoints optimized for Asia-Pacific region',
        location: 'Tokyo, Japan',
        region: 'asia-east',
        infrastructure: 'Bare Metal',
        status: 'ONLINE',
        totalContracts: 67,
        activeContracts: 18,
        uptime: 99.5,
        avgLatency: 22,
        reputation: 4.6,
        earnings: {
          daily: 1800000000,
          weekly: 12600000000,
          monthly: 50400000000,
        },
        services: [
          { id: 7, name: 'Solana', paygoRate: '2' },
          { id: 2, name: 'Ethereum', paygoRate: '4' },
          { id: 1, name: 'Arkeo', paygoRate: '1' },
        ],
      },
      {
        id: 'p6',
        pubKey: 'arkeopub1addwnpepqk2xvkz3k5tq8snx4d3v',
        moniker: 'WestCoast RPC',
        description: 'Fast and reliable nodes serving the Western Americas',
        location: 'Los Angeles, USA',
        region: 'na-west',
        infrastructure: 'Bare Metal',
        status: 'ONLINE',
        totalContracts: 45,
        activeContracts: 14,
        uptime: 99.4,
        avgLatency: 35,
        reputation: 4.5,
        earnings: {
          daily: 980000000,
          weekly: 6860000000,
          monthly: 27440000000,
        },
        services: [
          { id: 6, name: 'Base', paygoRate: '2' },
          { id: 7, name: 'Solana', paygoRate: '2' },
          { id: 8, name: 'Avalanche', paygoRate: '3' },
        ],
      },
      {
        id: 'p7',
        pubKey: 'arkeopub1addwnpepql3xvkz3k5tq8snx4d3w',
        moniker: 'Sydney Chain',
        description: 'Premium RPC services for Oceania with ultra-low latency',
        location: 'Sydney, Australia',
        region: 'oceania',
        infrastructure: 'AWS',
        status: 'ONLINE',
        totalContracts: 34,
        activeContracts: 9,
        uptime: 99.3,
        avgLatency: 48,
        reputation: 4.4,
        earnings: {
          daily: 720000000,
          weekly: 5040000000,
          monthly: 20160000000,
        },
        services: [
          { id: 2, name: 'Ethereum', paygoRate: '5' },
          { id: 9, name: 'BNB Chain', paygoRate: '2' },
          { id: 4, name: 'Osmosis', paygoRate: '1' },
        ],
      },
      {
        id: 'p8',
        pubKey: 'arkeopub1addwnpepqm4xvkz3k5tq8snx4d3x',
        moniker: 'Budget RPC',
        description: 'Affordable RPC endpoints for developers and small projects',
        location: 'Virginia, USA',
        region: 'na-east',
        infrastructure: 'Bare Metal',
        status: 'OFFLINE',
        totalContracts: 23,
        activeContracts: 0,
        uptime: 94.2,
        avgLatency: 85,
        reputation: 3.8,
        earnings: {
          daily: 0,
          weekly: 150000000,
          monthly: 890000000,
        },
        services: [
          { id: 1, name: 'Arkeo', paygoRate: '0.5' },
        ],
      },
    ];

    const SMART_SELECT_CRITERIA = [
      { id: 'price', label: 'Lowest Price', icon: 'ðŸ’°', description: 'Find the cheapest rate per query' },
      { id: 'latency', label: 'Fastest Response', icon: 'âš¡', description: 'Lowest latency for speed-critical apps' },
      { id: 'uptime', label: 'Most Reliable', icon: 'ðŸ›¡ï¸', description: '99.9%+ uptime guarantee providers' },
    ];

    // Utilities
    const formatArkeo = (uarkeo, decimals = 2) => {
      const val = parseInt(uarkeo) / 1_000_000;
      if (val >= 1_000_000) return (val / 1_000_000).toFixed(1) + 'M';
      if (val >= 1_000) return (val / 1_000).toFixed(1) + 'K';
      return val.toFixed(decimals);
    };

    const getEarningsByRange = (provider, range) => {
      const { earnings } = provider;
      switch (range) {
        case 'today': return earnings.daily;
        case 'this_week': return earnings.weekly;
        case 'this_month': return earnings.monthly;
        case 'last_month': return Math.round(earnings.monthly * 0.9);
        case 'all_time': return Math.round(earnings.monthly * 6);
        default: return earnings.monthly;
      }
    };

    const TIME_RANGES = [
      { id: 'today', label: 'Today' },
      { id: 'this_week', label: 'This Week' },
      { id: 'this_month', label: 'This Month' },
      { id: 'last_month', label: 'Last Month' },
      { id: 'all_time', label: 'All Time' },
    ];

    const SORT_OPTIONS = [
      { id: 'cost', label: 'Best Cost' },
      { id: 'reliability', label: 'Best Reliability' },
    ];

    // Icons
    const Icons = {
      Server: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2" /></svg>,
      Zap: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>,
      Close: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
      Check: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
      Search: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
      Globe: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
      Activity: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>,
      External: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>,
      Wand: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>,
      Docker: () => <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M13.983 11.078h2.119a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.119a.185.185 0 00-.185.185v1.888c0 .102.083.185.185.185m-2.954-5.43h2.118a.186.186 0 00.186-.186V3.574a.186.186 0 00-.186-.185h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.185m0 2.716h2.118a.187.187 0 00.186-.186V6.29a.186.186 0 00-.186-.185h-2.118a.185.185 0 00-.185.185v1.887c0 .102.082.186.185.186m-2.93 0h2.12a.186.186 0 00.184-.186V6.29a.185.185 0 00-.185-.185H8.1a.185.185 0 00-.185.185v1.887c0 .102.083.186.185.186m-2.964 0h2.119a.186.186 0 00.185-.186V6.29a.185.185 0 00-.185-.185H5.136a.186.186 0 00-.186.185v1.887c0 .102.084.186.186.186m5.893 2.715h2.118a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.185m-2.93 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.185.185 0 00-.184.185v1.888c0 .102.083.185.185.185m-2.964 0h2.119a.185.185 0 00.185-.185V9.006a.185.185 0 00-.185-.186h-2.12a.186.186 0 00-.185.186v1.887c0 .102.084.185.186.185m-2.92 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.185.185 0 00-.184.185v1.888c0 .102.082.185.185.185M23.763 9.89c-.065-.051-.672-.51-1.954-.51-.338.001-.676.03-1.01.087-.248-1.7-1.653-2.53-1.716-2.566l-.344-.199-.226.327c-.284.438-.49.922-.612 1.43-.23.97-.09 1.882.403 2.661-.595.332-1.55.413-1.744.42H.751a.751.751 0 00-.75.748 11.376 11.376 0 00.692 4.062c.545 1.428 1.355 2.48 2.41 3.124 1.18.723 3.1 1.137 5.275 1.137.983.003 1.963-.086 2.93-.266a12.248 12.248 0 003.823-1.389c.98-.567 1.86-1.288 2.61-2.136 1.252-1.418 1.998-2.997 2.553-4.4h.221c1.372 0 2.215-.549 2.68-1.009.309-.293.55-.65.707-1.046l.098-.288z"/></svg>,
      Cloud: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" /></svg>,
      Chip: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" /></svg>,
      Cart: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>,
      MapPin: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
      ChevronDown: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>,
      DollarSign: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
    };

    // Arkeo Logo Component
    const ArkeoLogo = ({ size = 44 }) => (
      <img
        src="images/arkeo-logo-200px_1.png"
        alt="Arkeo"
        style={{ width: size, height: size, objectFit: 'contain' }}
        className="rounded-full bg-arkeo/10 p-1 shadow-sm"
      />
    );

    // Stats Card
    const StatsCard = ({ icon, label, value, subvalue, color }) => (
      <div className="card-surface backdrop-blur rounded-2xl p-5 transition-all hover:border-arkeo/60">
        <div className="flex items-start justify-between">
          <div>
            <p className="text-secondaryText text-sm mb-1">{label}</p>
            <p className={`text-3xl font-bold ${color || 'text-white'}`}>{value}</p>
            {subvalue && <p className="text-secondaryText text-xs mt-1">{subvalue}</p>}
          </div>
          <div className="p-3 rounded-xl bg-arkeo/15 text-arkeo">{icon}</div>
        </div>
      </div>
    );

    // Infrastructure Badge
    const InfrastructureBadge = () => null;

    // Earnings Display Component
    const EarningsDisplay = ({ earnings }) => {
      const [period, setPeriod] = useState('daily');
      
      const periods = [
        { id: 'daily', label: 'Daily' },
        { id: 'weekly', label: 'Weekly' },
        { id: 'monthly', label: 'Monthly' },
      ];

      return (
        <div className="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-3">
          <div className="flex items-center justify-between mb-2">
            <span className="text-emerald-400 text-xs font-medium flex items-center gap-1">
              <Icons.DollarSign /> Earnings
            </span>
            <div className="flex gap-1">
              {periods.map(p => (
                <button
                  key={p.id}
                  onClick={(e) => { e.stopPropagation(); setPeriod(p.id); }}
                  className={`px-2 py-0.5 rounded text-xs font-medium transition-all ${period === p.id ? 'bg-emerald-500 text-slate-900' : 'text-emerald-400 hover:bg-emerald-500/20'}`}
                >
                  {p.label}
                </button>
              ))}
            </div>
          </div>
          <p className="text-xl font-bold text-emerald-400">{formatArkeo(earnings[period])} <span className="text-sm font-normal">ARKEO</span></p>
        </div>
      );
    };

    // Location Filter Dropdown
    const LocationFilter = ({ selectedRegion, onSelect }) => {
      const [isOpen, setIsOpen] = useState(false);
      const selected = REGIONS.find(r => r.id === selectedRegion) || REGIONS[0];

      return (
        <div className="relative">
          <button
            onClick={() => setIsOpen(!isOpen)}
            className="flex items-center gap-2 card-surface rounded-xl px-4 py-3 text-white hover:border-arkeo/60 transition-all min-w-[200px]"
          >
            <Icons.MapPin />
            <span className="flex-1 text-left text-sm">{selected.icon} {selected.name}</span>
            <Icons.ChevronDown />
          </button>
          
          {isOpen && (
            <>
              <div className="fixed inset-0 z-40" onClick={() => setIsOpen(false)} />
              <div className="absolute top-full left-0 right-0 mt-2 bg-[var(--surface)] border border-[var(--border)] rounded-xl shadow-2xl py-2 z-50 max-h-64 overflow-y-auto">
                {REGIONS.map(region => (
                  <button
                    key={region.id}
                    onClick={() => { onSelect(region.id); setIsOpen(false); }}
                    className={`w-full text-left px-4 py-2.5 text-sm transition-colors flex items-center gap-2 ${selectedRegion === region.id ? 'bg-primary/15 text-white' : 'text-secondaryText hover:bg-[#1E222C]'}`}
                  >
                    <span>{region.icon}</span>
                    <span>{region.name}</span>
                  </button>
                ))}
              </div>
            </>
          )}
        </div>
      );
    };

    const DataServiceFilter = ({ selected, onSelect }) => {
      const [isOpen, setIsOpen] = useState(false);
      const [query, setQuery] = useState('');
      const options = [{ id: 'all', name: 'All Types', icon: 'ðŸŒ' }, ...SERVICES];
      const active = options.find(o => o.id === selected) || options[0];
      const filtered = options.filter(o => o.name.toLowerCase().includes(query.toLowerCase()));

      return (
        <div className="relative">
          <button onClick={() => setIsOpen(!isOpen)} className="flex items-center gap-2 card-surface rounded-xl px-4 py-3 text-white hover:border-arkeo/60 transition-all min-w-[220px]">
            <Icons.Server />
            <span className="flex-1 text-left text-sm truncate">{active.name}</span>
            <Icons.ChevronDown />
          </button>
          {isOpen && (
            <>
              <div className="fixed inset-0 z-40" onClick={() => setIsOpen(false)} />
              <div className="absolute top-full left-0 right-0 mt-2 bg-[var(--surface)] border border-[var(--border)] rounded-xl shadow-2xl py-2 z-50 max-h-72 overflow-y-auto">
                <div className="px-3 pb-2">
                  <input
                    autoFocus
                    value={query}
                    onChange={e => setQuery(e.target.value)}
                    placeholder="Search services..."
                    className="w-full bg-[var(--bg-main)] border border-[var(--border)] rounded-lg px-3 py-2 text-sm text-white placeholder-secondaryText focus:border-primary focus:ring-1 focus:ring-primary"
                  />
                </div>
                {filtered.map(opt => (
                  <button
                    key={opt.id}
                    onClick={() => { onSelect(opt.id); setIsOpen(false); setQuery(''); }}
                    className={`w-full text-left px-4 py-2.5 text-sm transition-colors flex items-center gap-2 ${selected === opt.id ? 'bg-primary/15 text-white' : 'text-secondaryText hover:bg-[#1E222C]'}`}
                  >
                    <span>{opt.icon}</span>
                    <span>{opt.name}</span>
                  </button>
                ))}
                {filtered.length === 0 && <p className="text-secondaryText text-xs px-4 py-3">No matches</p>}
              </div>
            </>
          )}
        </div>
      );
    };

    const SimpleDropdown = ({ label, selected, options, onChange }) => {
      const [isOpen, setIsOpen] = useState(false);
      const active = options.find(o => o.id === selected) || options[0];
      return (
        <div className="relative">
          <button className="flex items-center gap-2 card-surface rounded-xl px-4 py-3 text-white hover:border-arkeo/60 transition-all min-w-[180px]" onClick={() => setIsOpen(!isOpen)}>
            <span className="text-sm text-secondaryText">{label}</span>
            <span className="flex-1 text-left text-sm text-white">{active.label}</span>
            <Icons.ChevronDown />
          </button>
          {isOpen && (
            <>
              <div className="fixed inset-0 z-40" onClick={() => setIsOpen(false)} />
              <div className="absolute top-full left-0 right-0 mt-2 bg-[var(--surface)] border border-[var(--border)] rounded-xl shadow-2xl py-2 z-50">
                {options.map(opt => (
                  <button
                    key={opt.id}
                    onClick={() => { onChange(opt.id); setIsOpen(false); }}
                    className={`w-full text-left px-4 py-2 text-sm transition-colors ${opt.id === selected ? 'bg-primary/15 text-white' : 'text-secondaryText hover:bg-[#1E222C]'}`}
                  >
                    {opt.label}
                  </button>
                ))}
              </div>
            </>
          )}
        </div>
      );
    };

    // Provider Card
    const ProviderCard = ({ provider, onOpenContract, serviceFilter }) => {
      const isOnline = provider.status === 'ONLINE';
      
      return (
        <div className={`card-surface backdrop-blur rounded-2xl overflow-hidden transition-all ${isOnline ? 'hover:border-arkeo/60 hover:shadow-[0_10px_30px_rgba(59,224,255,0.12)]' : 'opacity-70'}`}>
          <div className="p-5">
            <div className="flex items-start justify-between mb-3">
              <div className="flex-1">
                <div className="flex items-center gap-2 mb-1">
                  <h3 className="font-bold text-lg text-white">{provider.moniker}</h3>
                  <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${isOnline ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30' : 'bg-red-500/20 text-red-400 border border-red-500/30'}`}>{provider.status}</span>
                </div>
                <div className="flex items-center gap-2 text-secondaryText text-sm">
                  <span className="flex items-center gap-1"><Icons.Globe />{provider.location}</span>
                </div>
                <div className="flex flex-wrap gap-1 mt-2">
                  {[provider.location, provider.region].filter(Boolean).map((loc, idx) => (
                    <span key={idx} className="px-2 py-0.5 rounded-full text-xs font-medium bg-[#1E222C] text-secondaryText border border-[#1E222C]">{loc}</span>
                  ))}
                </div>
              </div>
              <a href={`provider.html?id=${provider.id}`} className="flex items-center gap-1 text-secondaryText hover:text-white text-sm px-2 py-1 rounded-lg hover:bg-[#1E222C]" title="View provider details">
                Details <Icons.External />
              </a>
            </div>

            <p className="text-secondaryText text-sm mb-4 line-clamp-2">{provider.description}</p>

            <div className="grid grid-cols-2 gap-2 mb-4">
              <div className="text-center p-2 rounded-lg bg-[#1E222C]"><p className="text-lg font-bold text-white">{provider.uptime}%</p><p className="text-xs text-secondaryText">Reliability</p></div>
              <div className="text-center p-2 rounded-lg bg-[#1E222C]"><p className="text-lg font-bold text-white">{serviceFilter === 'all' ? provider.services.length : provider.services.filter(s => s.id === serviceFilter).length}</p><p className="text-xs text-secondaryText">Data Services</p></div>
            </div>

            {/* Earnings Display */}
            <div className="mb-4">
              <EarningsDisplay earnings={provider.earnings} />
            </div>
          </div>
        </div>
      );
    };

    // Smart Select Modal - Updated with all services
    const SmartSelectModal = ({ isOpen, onClose, onSuccess }) => {
      const [selectedService, setSelectedService] = useState(null);
      const [selectedCriteria, setSelectedCriteria] = useState('price');
      const [step, setStep] = useState(1);
      const [txState, setTxState] = useState('idle');
      const [recommendedProvider, setRecommendedProvider] = useState(null);

      useEffect(() => { if (isOpen) { setStep(1); setSelectedService(null); setTxState('idle'); setRecommendedProvider(null); } }, [isOpen]);

      if (!isOpen) return null;

      const findBestProvider = () => {
        const providersWithService = MOCK_PROVIDERS.filter(p => p.status === 'ONLINE' && p.services.some(s => s.id === selectedService));
        if (providersWithService.length === 0) return null;
        
        let sorted;
        switch (selectedCriteria) {
          case 'price': sorted = providersWithService.sort((a, b) => parseInt(a.services.find(s => s.id === selectedService)?.paygoRate || '999') - parseInt(b.services.find(s => s.id === selectedService)?.paygoRate || '999')); break;
          case 'latency': sorted = providersWithService.sort((a, b) => b.uptime - a.uptime); break;
          case 'uptime': sorted = providersWithService.sort((a, b) => b.uptime - a.uptime); break;
          default: sorted = providersWithService.sort((a, b) => b.uptime - a.uptime);
        }
        return sorted[0];
      };

      const handleFindProvider = () => { setRecommendedProvider(findBestProvider()); setStep(3); };

      const handleSubmit = async () => {
        setTxState('signing');
        await new Promise(r => setTimeout(r, 1500));
        setTxState('broadcasting');
        await new Promise(r => setTimeout(r, 2000));
        setTxState('success');
        onSuccess?.();
      };

      const criteria = SMART_SELECT_CRITERIA.find(c => c.id === selectedCriteria);

      return (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
          <div className="card-surface rounded-2xl max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
            <div className="flex items-center justify-between p-6 border-b border-[var(--border)]">
              <div className="flex items-center gap-3">
                <div className="p-2.5 rounded-xl bg-primary/15 text-white"><Icons.Wand /></div>
                <div>
                  <h2 className="text-xl font-bold text-white">Smart Provider Selection</h2>
                  <p className="text-secondaryText text-sm">Find the best provider for your needs</p>
                </div>
              </div>
              <button onClick={onClose} className="p-2 hover:bg-[#1E222C] rounded-xl text-secondaryText"><Icons.Close /></button>
            </div>

            {txState === 'success' ? (
              <div className="p-8 text-center">
                <div className="w-20 h-20 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-6 text-emerald-400"><Icons.Check /></div>
                <h3 className="text-2xl font-bold text-white mb-2">Contract Opened!</h3>
                <p className="text-secondaryText mb-6">Your contract with {recommendedProvider?.moniker} is now active.</p>
                <button onClick={onClose} className="w-full primary-gradient text-white font-semibold py-3 rounded-xl primary-shadow">Done</button>
              </div>
            ) : txState !== 'idle' ? (
              <div className="p-8 text-center">
                <div className="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-6" />
                <p className="text-lg font-medium text-white">{txState === 'signing' ? 'Sign in Wallet...' : 'Broadcasting...'}</p>
              </div>
            ) : (
              <>
                <div className="flex items-center justify-center gap-2 py-4 border-b border-[var(--border)]">
                  {[1, 2, 3].map(s => (
                    <React.Fragment key={s}>
                      <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${step >= s ? 'bg-primary text-white' : 'bg-[#1E222C] text-secondaryText'}`}>{step > s ? 'âœ“' : s}</div>
                      {s < 3 && <div className={`w-12 h-0.5 ${step > s ? 'bg-primary' : 'bg-[#1E222C]'}`} />}
                    </React.Fragment>
                  ))}
                </div>

                <div className="p-6">
                  {step === 1 && (
                    <>
                      <h3 className="text-lg font-semibold text-white mb-4">Select Service / Chain</h3>
                      <p className="text-secondaryText text-sm mb-4">Choose from all supported blockchains on the Arkeo marketplace</p>
                      <div className="grid grid-cols-3 gap-3">
                        {SERVICES.map(svc => (
                          <button key={svc.id} onClick={() => setSelectedService(svc.id)} className={`p-4 rounded-xl border-2 text-center transition-all ${selectedService === svc.id ? 'border-primary bg-primary/10' : 'border-[var(--border)] bg-[var(--surface)] hover:border-primary/40'}`}>
                            <span className="text-2xl mb-2 block">{svc.icon}</span>
                            <p className="font-medium text-white text-sm">{svc.name}</p>
                          </button>
                        ))}
                      </div>
                    </>
                  )}

                  {step === 2 && (
                    <>
                      <h3 className="text-lg font-semibold text-white mb-4">What matters most?</h3>
                      <div className="space-y-3">
                        {SMART_SELECT_CRITERIA.map(c => (
                          <button key={c.id} onClick={() => setSelectedCriteria(c.id)} className={`w-full p-4 rounded-xl border-2 text-left flex items-center gap-4 ${selectedCriteria === c.id ? 'border-primary bg-primary/10' : 'border-[var(--border)] bg-[var(--surface)] hover:border-primary/40'}`}>
                            <span className="text-2xl">{c.icon}</span>
                            <div><p className="font-semibold text-white">{c.label}</p><p className="text-sm text-secondaryText">{c.description}</p></div>
                          </button>
                        ))}
                      </div>
                    </>
                  )}

                  {step === 3 && recommendedProvider && (
                    <>
                      <div className="bg-primary/10 border border-primary/40 rounded-xl p-4 mb-6">
                        <p className="text-arkeo text-sm mb-1">ðŸŽ¯ Best match for {criteria?.label}</p>
                        <p className="text-white font-bold text-lg">{recommendedProvider.moniker}</p>
                        <p className="text-secondaryText text-sm">{recommendedProvider.location}</p>
                      </div>
                      <div className="card-surface rounded-xl p-4 mb-4">
                        <div className="grid grid-cols-3 gap-4 text-center">
                          <div><p className="text-2xl font-bold text-white">{recommendedProvider.uptime}%</p><p className="text-xs text-secondaryText">Reliability</p></div>
                          <div><p className="text-2xl font-bold text-white">{serviceFilter === 'all' ? recommendedProvider.services.length : recommendedProvider.services.filter(s => s.id === serviceFilter).length}</p><p className="text-xs text-secondaryText">Services</p></div>
                          <div><p className="text-2xl font-bold text-white">{recommendedProvider.location}</p><p className="text-xs text-secondaryText">Location</p></div>
                        </div>
                      </div>
                      <EarningsDisplay earnings={recommendedProvider.earnings} />
                    </>
                  )}

                  {step === 3 && !recommendedProvider && (
                    <div className="text-center py-8">
                      <p className="text-secondaryText">No providers found for this service. Try a different chain.</p>
                    </div>
                  )}
                </div>

                <div className="p-6 border-t border-[var(--border)] flex gap-3">
                  {step > 1 && <button onClick={() => setStep(step - 1)} className="flex-1 px-4 py-3 rounded-xl font-medium secondary-btn hover:brightness-110">Back</button>}
                  {step < 3 ? (
                    <button onClick={() => step === 2 ? handleFindProvider() : setStep(step + 1)} disabled={step === 1 && !selectedService} className="flex-1 primary-gradient text-white font-semibold py-3 rounded-xl primary-shadow disabled:opacity-40 disabled:cursor-not-allowed">
                      {step === 2 ? 'Find Best Provider' : 'Continue'}
                    </button>
                  ) : recommendedProvider && (
                    <button onClick={handleSubmit} className="flex-1 primary-gradient text-white font-semibold py-3 rounded-xl flex items-center justify-center gap-2 primary-shadow">
                      <Icons.Zap /> Open Contract
                    </button>
                  )}
                </div>
              </>
            )}
          </div>
        </div>
      );
    };

    // Become Provider Modal
    const BecomeProviderModal = ({ isOpen, onClose }) => {
      const [step, setStep] = useState(1);
      const [setupType, setSetupType] = useState(null);

      useEffect(() => { if (isOpen) { setStep(1); setSetupType(null); } }, [isOpen]);

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
          <div className="card-surface rounded-2xl max-w-3xl w-full shadow-2xl max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
            <div className="flex items-center justify-between p-6 border-b border-[var(--border)]">
              <div className="flex items-center gap-3">
                <div className="p-2.5 rounded-xl bg-primary/15 text-white"><Icons.Server /></div>
                <div>
                  <h2 className="text-xl font-bold text-white">Become a Data Provider</h2>
                  <p className="text-secondaryText text-sm">Start earning ARKEO</p>
                </div>
              </div>
              <button onClick={onClose} className="p-2 hover:bg-[#1E222C] rounded-xl text-secondaryText"><Icons.Close /></button>
            </div>

            <div className="p-6">
              {step === 1 && (
                <>
                  <h3 className="text-lg font-semibold text-white mb-2">Choose Setup Method</h3>
                  <p className="text-secondaryText mb-6">Select how you'd like to set up your provider</p>
                  <div className="grid md:grid-cols-2 gap-4">
                    <button onClick={() => { setSetupType('docker'); setStep(2); }} className="p-6 rounded-2xl border-2 border-[var(--border)] bg-[var(--surface)] hover:border-arkeo/60 hover:bg-arkeo/5 transition-all text-left group">
                    <div className="w-14 h-14 bg-primary/15 rounded-2xl flex items-center justify-center mb-4 text-arkeo group-hover:scale-110 transition-transform"><Icons.Docker /></div>
                      <h4 className="text-lg font-bold text-white mb-2">Docker Setup</h4>
                      <p className="text-secondaryText text-sm mb-4">Recommended. Pre-configured container with admin UI.</p>
                      <ul className="space-y-2 text-sm text-arkeo">
                        <li>âœ“ One-command setup</li>
                        <li>âœ“ Built-in management UI</li>
                        <li>âœ“ Auto-updates</li>
                      </ul>
                    </button>
                    <button onClick={() => { setSetupType('manual'); setStep(2); }} className="p-6 rounded-2xl border-2 border-[var(--border)] bg-[var(--surface)] hover:border-arkeo/60 hover:bg-arkeo/5 transition-all text-left group">
                    <div className="w-14 h-14 bg-primary/15 rounded-2xl flex items-center justify-center mb-4 text-arkeo group-hover:scale-110 transition-transform"><Icons.Wand /></div>
                      <h4 className="text-lg font-bold text-white mb-2">Manual Setup</h4>
                      <p className="text-secondaryText text-sm mb-4">For advanced users wanting full control.</p>
                      <ul className="space-y-2 text-sm text-arkeo">
                        <li>âœ“ Full customization</li>
                        <li>âœ“ Use existing nodes</li>
                        <li>âœ“ Advanced config</li>
                      </ul>
                    </button>
                  </div>
                </>
              )}

              {step === 2 && setupType === 'docker' && (
                <>
                  <div className="flex items-center gap-2 text-arkeo mb-4"><Icons.Docker /><span className="font-medium">Docker Setup</span></div>
                  <h3 className="text-lg font-semibold text-white mb-4">Quick Start</h3>
                  <div className="space-y-4">
                    <div className="card-surface rounded-xl p-4">
                      <p className="text-sm text-secondaryText mb-2">1. Clone the repository</p>
                      <code className="block bg-[var(--bg-main)] rounded-lg p-3 text-arkeo text-sm font-mono border border-[var(--border)]">git clone https://github.com/arkeonetwork/arkeo-data-engine.git</code>
                    </div>
                    <div className="card-surface rounded-xl p-4">
                      <p className="text-sm text-secondaryText mb-2">2. Navigate to provider-core</p>
                      <code className="block bg-[var(--bg-main)] rounded-lg p-3 text-arkeo text-sm font-mono border border-[var(--border)]">cd arkeo-data-engine/provider-core</code>
                    </div>
                    <div className="card-surface rounded-xl p-4">
                      <p className="text-sm text-secondaryText mb-2">3. Start the container</p>
                      <code className="block bg-[var(--bg-main)] rounded-lg p-3 text-arkeo text-sm font-mono border border-[var(--border)]">docker-compose up -d</code>
                    </div>
                    <div className="card-surface rounded-xl p-4">
                      <p className="text-sm text-secondaryText mb-2">4. Access Admin UI</p>
                      <code className="block bg-[var(--bg-main)] rounded-lg p-3 text-arkeo text-sm font-mono border border-[var(--border)]">Open http://localhost:3000</code>
                    </div>
                    <div className="bg-primary/10 border border-primary/40 rounded-xl p-4">
                      <p className="text-arkeo text-sm">ðŸ’¡ The Admin UI will guide you through connecting nodes, setting rates, and bonding.</p>
                    </div>
                  </div>
                  <div className="mt-6 flex gap-3">
                    <button onClick={() => setStep(1)} className="flex-1 px-4 py-3 rounded-xl font-medium secondary-btn hover:brightness-110">Back</button>
                    <a href="https://github.com/arkeonetwork/arkeo-data-engine" target="_blank" className="flex-1 primary-gradient text-white font-semibold py-3 rounded-xl flex items-center justify-center gap-2 primary-shadow">
                      View on GitHub <Icons.External />
                    </a>
                  </div>
                </>
              )}

              {step === 2 && setupType === 'manual' && (
                <>
                  <div className="flex items-center gap-2 text-arkeo mb-4"><Icons.Wand /><span className="font-medium">Manual Setup</span></div>
                  <h3 className="text-lg font-semibold text-white mb-4">Manual Configuration</h3>
                  <div className="space-y-4">
                    <div className="card-surface rounded-xl p-4">
                      <h4 className="font-medium text-white mb-2">Prerequisites</h4>
                      <ul className="space-y-1 text-sm text-secondaryText">
                        <li>â€¢ Running blockchain full node</li>
                        <li>â€¢ Arkeo wallet with ARKEO for bonding</li>
                        <li>â€¢ Server with public IP</li>
                        <li>â€¢ arkeod and sentinel binaries</li>
                      </ul>
                    </div>
                    <div className="card-surface rounded-xl p-4">
                      <h4 className="font-medium text-white mb-2">Steps</h4>
                      <ol className="space-y-2 text-sm text-secondaryText list-decimal list-inside">
                        <li>Bond ARKEO as collateral</li>
                        <li>Configure Sentinel</li>
                        <li>Set pricing</li>
                        <li>Host metadata.json</li>
                        <li>Start Sentinel service</li>
                      </ol>
                    </div>
                  </div>
                  <div className="mt-6 flex gap-3">
                    <button onClick={() => setStep(1)} className="flex-1 px-4 py-3 rounded-xl font-medium secondary-btn hover:brightness-110">Back</button>
                    <a href="https://docs.arkeo.network/arkeo-for-data-providers/setup" target="_blank" className="flex-1 primary-gradient text-white font-semibold py-3 rounded-xl flex items-center justify-center gap-2 primary-shadow">
                      View Docs <Icons.External />
                    </a>
                  </div>
                </>
              )}
            </div>
          </div>
        </div>
      );
    };

    // How It Works Modal (one-time popup and on-demand)
    const HowItWorksModal = ({ isOpen, onClose }) => {
      if (!isOpen) return null;
      return (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
          <div className="card-surface rounded-2xl max-w-4xl w-full shadow-2xl max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
            <div className="flex items-center justify-between p-6 border-b border-[var(--border)]">
              <div className="flex items-center gap-3">
                <div className="p-2.5 rounded-xl bg-arkeo/15 text-arkeo"><Icons.Wand /></div>
                <div>
                  <h2 className="text-xl font-bold text-white">How Arkeo Works</h2>
                  <p className="text-secondaryText text-sm">30-second walkthrough for providers and subscribers</p>
                </div>
              </div>
              <button onClick={onClose} className="p-2 hover:bg-[#1E222C] rounded-xl text-secondaryText"><Icons.Close /></button>
            </div>
            <div className="p-6 grid md:grid-cols-2 gap-6 items-center">
              <div className="space-y-3">
                <p className="text-sm text-secondaryText">Arkeo is a decentralized marketplace where data providers publish access endpoints and subscribers pay per query using ARKEO tokens.</p>
                <ul className="space-y-2 text-secondaryText text-sm">
                  <li>â€¢ Providers: bond ARKEO, publish endpoints, earn per query.</li>
                  <li>â€¢ Subscribers: discover endpoints, open PAYG contracts, monitor uptime.</li>
                  <li>â€¢ Settlement: metered usage with transparent pricing and reputation.</li>
                </ul>
                <div className="flex gap-3">
                  <a href="https://docs.arkeo.network" target="_blank" className="secondary-btn px-4 py-2.5 rounded-xl font-medium border border-[var(--border)] hover:brightness-110">View Docs</a>
                  <button onClick={onClose} className="primary-gradient text-white font-semibold px-4 py-2.5 rounded-xl primary-shadow">Got it</button>
                </div>
              </div>
              <div className="relative rounded-2xl overflow-hidden border border-[var(--border)] shadow-lg">
                <div className="absolute inset-0 bg-[radial-gradient(circle_at_top_right,rgba(255,79,210,0.15),transparent_55%),radial-gradient(circle_at_bottom_left,rgba(255,138,43,0.15),transparent_55%)]" />
                <div className="relative aspect-video">
                  <iframe
                    src="https://www.youtube.com/embed/nCgQDjiotG0?rel=0"
                    title="How Arkeo Works"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowFullScreen
                    loading="lazy"
                    className="absolute inset-0 w-full h-full"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Open Contract Modal
    const OpenContractModal = ({ provider, isOpen, onClose, onSuccess }) => {
      const [selectedService, setSelectedService] = useState(null);
      const [txState, setTxState] = useState('idle');

      useEffect(() => { if (isOpen && provider?.services?.length) { setSelectedService(provider.services[0].id); setTxState('idle'); } }, [isOpen, provider]);

      if (!isOpen || !provider) return null;

      const service = provider.services.find(s => s.id === selectedService);
      const cost = service ? (parseInt(service.paygoRate) * 10000) / 1_000_000 : 0;

      const handleSubmit = async () => {
        setTxState('signing');
        await new Promise(r => setTimeout(r, 1500));
        setTxState('broadcasting');
        await new Promise(r => setTimeout(r, 2000));
        setTxState('success');
        onSuccess?.();
      };

      if (txState === 'success') {
        return (
          <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
            <div className="card-surface rounded-2xl max-w-lg w-full p-8 text-center" onClick={e => e.stopPropagation()}>
              <div className="w-20 h-20 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-6 text-emerald-400"><Icons.Check /></div>
              <h3 className="text-2xl font-bold text-white mb-2">Contract Opened!</h3>
              <p className="text-secondaryText mb-6">Your contract with {provider.moniker} is active.</p>
              <button onClick={onClose} className="w-full primary-gradient text-white font-semibold py-3 rounded-xl primary-shadow">Done</button>
            </div>
          </div>
        );
      }

      if (txState !== 'idle') {
        return (
          <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div className="card-surface rounded-2xl max-w-lg w-full p-8 text-center">
              <div className="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-6" />
              <p className="text-lg font-medium text-white">{txState === 'signing' ? 'Sign in Wallet...' : 'Broadcasting...'}</p>
            </div>
          </div>
        );
      }

      return (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
          <div className="card-surface rounded-2xl max-w-lg w-full shadow-2xl" onClick={e => e.stopPropagation()}>
            <div className="flex items-center justify-between p-6 border-b border-[var(--border)]">
              <h2 className="text-xl font-bold text-white">Open Contract</h2>
              <button onClick={onClose} className="p-2 hover:bg-[#1E222C] rounded-xl text-secondaryText"><Icons.Close /></button>
            </div>
            <div className="p-6 space-y-5">
              <div className="card-surface rounded-xl p-4">
                <div className="flex items-center justify-between mb-2">
                  <div><h3 className="font-bold text-white">{provider.moniker}</h3><p className="text-secondaryText text-sm">{provider.location}</p></div>
                </div>
              </div>
              
              <EarningsDisplay earnings={provider.earnings} />
              
              <div>
                <label className="block text-sm font-medium text-secondaryText mb-2">Select Service</label>
                <div className="grid grid-cols-2 gap-2">
                  {provider.services.map(svc => {
                    const svcInfo = SERVICES.find(s => s.id === svc.id);
                    return (
                      <button key={svc.id} onClick={() => setSelectedService(svc.id)} className={`p-3 rounded-xl text-left ${selectedService === svc.id ? 'bg-primary/10 border-2 border-primary' : 'bg-[var(--surface)] border-2 border-transparent hover:border-primary/40'}`}>
                        <p className="font-medium text-white text-sm">{svcInfo?.icon} {svc.name}</p>
                        <p className="text-xs text-secondaryText">{formatArkeo(svc.paygoRate, 6)} ARKEO/query</p>
                      </button>
                    );
                  })}
                </div>
              </div>
              <div className="bg-primary/10 border border-primary/40 rounded-xl p-4">
                <div className="flex justify-between items-center">
                  <span className="text-arkeo">Deposit (â‰ˆ10K queries)</span>
                  <span className="text-2xl font-bold text-white">{cost.toFixed(4)} ARKEO</span>
                </div>
              </div>
            </div>
            <div className="p-6 border-t border-[var(--border)]">
              <button onClick={handleSubmit} className="w-full primary-gradient text-white font-semibold py-3 rounded-xl flex items-center justify-center gap-2 primary-shadow">
                <Icons.Zap /> Open PAYG Contract
              </button>
            </div>
          </div>
        </div>
      );
    };

    // Main App
    function App() {
      const [showBecomeProvider, setShowBecomeProvider] = useState(false);
      const [showContractModal, setShowContractModal] = useState(false);
      const [showHowItWorks, setShowHowItWorks] = useState(false);
      const [contractProvider, setContractProvider] = useState(null);
      const [serviceFilter, setServiceFilter] = useState('all');
      const [regionFilter, setRegionFilter] = useState('all');
      const [providerSearch, setProviderSearch] = useState('');
      const [timeRange, setTimeRange] = useState('this_month');
      const [sortBy, setSortBy] = useState('reliability');
      const [showOffline, setShowOffline] = useState(false);
      const [notification, setNotification] = useState(null);
      const timeRangeLabel = useMemo(() => TIME_RANGES.find(t => t.id === timeRange)?.label || 'This Month', [timeRange]);

      const filteredProviders = useMemo(() => {
        const filtered = MOCK_PROVIDERS.filter(p => {
          if (!showOffline && p.status !== 'ONLINE') return false;
          if (serviceFilter !== 'all' && !p.services.some(s => s.id === serviceFilter)) return false;
          if (regionFilter !== 'all' && p.region !== regionFilter) return false;
          if (providerSearch && !p.moniker.toLowerCase().includes(providerSearch.toLowerCase())) return false;
          return true;
        });

        return filtered.sort((a, b) => {
          if (sortBy === 'cost') {
            const rateFor = (p) => {
              const rates = serviceFilter === 'all' ? p.services : p.services.filter(s => s.id === serviceFilter);
              const min = rates.reduce((acc, s) => Math.min(acc, parseFloat(s.paygoRate || '9999')), 9999);
              return isFinite(min) ? min : 9999;
            };
            return rateFor(a) - rateFor(b);
          }
          // reliability: uptime desc
          return b.uptime - a.uptime;
        });
      }, [serviceFilter, regionFilter, providerSearch, sortBy, showOffline]);

      const summary = useMemo(() => {
        const providers = filteredProviders;
        return {
          providers: providers.length,
          online: providers.filter(p => p.status === 'ONLINE').length,
          contracts: providers.reduce((sum, p) => sum + p.activeContracts, 0),
          volume: providers.reduce((sum, p) => sum + getEarningsByRange(p, timeRange), 0),
          dailyVolume: providers.reduce((sum, p) => sum + getEarningsByRange(p, 'today'), 0),
        };
      }, [filteredProviders, timeRange]);

      const earningsMomentum = useMemo(() => {
        const totalRange = summary.volume || 0;
        const base = totalRange ? totalRange / 7 : 0;
        const labels = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
        const series = labels.map((_, i) => Math.max(0, base * (0.9 + i * 0.06)));
        const total = series.reduce((a, b) => a + b, 0);
        return { labels, series, total };
      }, [summary.volume]);

      const showNotif = (msg) => { setNotification(msg); setTimeout(() => setNotification(null), 3000); };

      useEffect(() => {
        try {
          const seen = localStorage.getItem('arkeo-how-it-works-seen');
          if (!seen) {
            setShowHowItWorks(true);
            localStorage.setItem('arkeo-how-it-works-seen', '1');
          }
        } catch (e) {
          // safe fallback if localStorage unavailable
        }
      }, []);

      return (
        <div className="min-h-screen bg-background text-white">
          {notification && <div className="fixed top-4 right-4 z-50 px-5 py-3 rounded-xl bg-emerald-500 text-white font-medium shadow-xl animate-pulse">{notification}</div>}

          <header className="sticky top-0 z-40 backdrop-blur-xl bg-background/90 border-b border-border relative overflow-hidden">
            <div className="absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_top_right,rgba(59,224,255,0.12),transparent_50%),radial-gradient(circle_at_bottom_left,rgba(59,224,255,0.08),transparent_45%)]" />
            <div className="max-w-7xl mx-auto px-4 py-4 relative z-10">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <ArkeoLogo size={44} />
                  <div>
                    <h1 className="text-xl font-bold text-white">The Arkeo Data Marketplace</h1>
                    <p className="text-xs text-secondaryText">Powering a global economy of data.</p>
                  </div>
                </div>
                <div className="flex flex-wrap items-center justify-end gap-3">
                  <button onClick={() => setShowBecomeProvider(true)} className="primary-gradient text-white font-semibold px-4 py-2.5 rounded-xl transition-all primary-shadow flex items-center gap-2">
                    <Icons.Server /> I Want to Provide Data
                  </button>
                  <button onClick={() => setShowHowItWorks(true)} className="primary-gradient text-white font-semibold px-4 py-2.5 rounded-xl transition-all primary-shadow flex items-center gap-2">
                    <Icons.Wand /> I Want to Use Data
                  </button>
                  <a href="https://app.osmosis.zone/?from=USDC&to=ARKEO" target="_blank" rel="noopener noreferrer"
                    className="flex items-center gap-2 bg-arkeo text-slate-900 font-semibold px-4 py-2.5 rounded-xl transition-all hover:brightness-110">
                    <Icons.Cart /> Get ARKEO Token
                  </a>
                </div>
              </div>
            </div>
          </header>

          <main className="max-w-7xl mx-auto px-4 py-8">
            <div className="card-surface rounded-2xl p-6 mb-8 relative overflow-hidden">
              <div className="absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_top_right,rgba(59,224,255,0.18),transparent_50%),radial-gradient(circle_at_bottom_left,rgba(59,224,255,0.12),transparent_45%)]" />
              <div className="relative z-10 grid md:grid-cols-3 gap-6 items-center">
                <div className="space-y-3 md:col-span-1">
                  <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-arkeo/10 text-arkeo text-xs font-semibold">
                    <Icons.Activity /> Marketplace Momentum
                  </div>
                  <h3 className="text-2xl font-bold text-white">Don't Miss Out on Arkeo Earnings!</h3>
                  <p className="text-secondaryText text-sm">Cumulative ARKEO paid to providers that match your current filters. Spin up your endpoints or secure your access before rates rise.</p>
                  <p className="text-arkeo text-lg font-semibold">{timeRangeLabel}: {formatArkeo(summary.volume, 0)} ARKEO</p>
                  <div className="flex gap-3">
                    <button onClick={() => setShowBecomeProvider(true)} className="bg-arkeo text-slate-900 font-semibold px-4 py-2.5 rounded-xl shadow-lg flex items-center gap-2 hover:brightness-110 transition-all">
                      <Icons.Server /> Start earning
                    </button>
                    <button onClick={() => setShowHowItWorks(true)} className="secondary-btn px-4 py-2.5 rounded-xl font-medium border border-[var(--border)] hover:brightness-110 flex items-center gap-2">
                      <Icons.Wand /> Learn how
                    </button>
                  </div>
                </div>
                <div className="md:col-span-2">
                  <div className="card-surface rounded-2xl p-4 border border-[var(--border)]">
                    <div className="flex items-center justify-between mb-3">
                      <div>
                        <p className="text-secondaryText text-xs">{timeRangeLabel} provider earnings (demo data)</p>
                        <p className="text-sm text-white font-semibold">Daily ARKEO paid out</p>
                      </div>
                      <p className="text-arkeo text-sm font-semibold">Peak: {formatArkeo(Math.max(...earningsMomentum.series), 0)} ARKEO</p>
                    </div>
                    <div className="flex items-end gap-2 h-36">
                      {earningsMomentum.series.map((val, idx) => {
                        const max = Math.max(...earningsMomentum.series, 0.0001);
                        const height = Math.max(12, (val / max) * 100);
                        return (
                          <div key={idx} className="flex-1 flex flex-col items-center gap-2">
                            <div className="w-full rounded-lg primary-gradient primary-shadow" style={{ height: `${height}%` }} />
                            <span className="text-secondaryText text-xs">{earningsMomentum.labels[idx]}</span>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
              <StatsCard icon={<Icons.Server />} label="Providers" value={summary.providers} subvalue={showOffline ? 'Including offline' : 'Online only'} color="text-arkeo" />
              <StatsCard icon={<Icons.Activity />} label="Contracts" value={summary.contracts} color="text-arkeo" />
              <StatsCard icon={<Icons.Globe />} label="Supported Data Types" value={SERVICES.length} color="text-arkeo" />
              <StatsCard icon={<Icons.Activity />} label="Arkeo Volume" value={`${formatArkeo(summary.volume, 0)} ARKEO`} subvalue={`${timeRangeLabel} volume`} color="text-arkeo" />
            </div>

              <div className="card-surface rounded-2xl p-6 mb-8 relative overflow-hidden">
                <div className="absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_top_right,rgba(59,224,255,0.18),transparent_50%),radial-gradient(circle_at_bottom_left,rgba(59,224,255,0.12),transparent_45%)]" />
                <div className="relative z-10 grid md:grid-cols-2 gap-6 items-center">
                  <div className="space-y-4">
                    <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-arkeo/10 text-arkeo text-xs font-semibold">
                      <Icons.Wand /> New: Arkeo in 30s
                    </div>
                    <h3 className="text-2xl font-bold text-white">What is Arkeo?</h3>
                    <p className="text-secondaryText text-sm">Watch a quick walkthrough on how providers publish data services, subscribers consume them, and ARKEO settles usage.</p>
                    <ul className="space-y-2 text-secondaryText text-sm">
                      <li>â€¢ Providers list endpoints, set prices, and earn ARKEO.</li>
                      <li>â€¢ Subscribers pick providers, open PAYG contracts, and track uptime.</li>
                      <li>â€¢ Reputation and metering keep the marketplace honest.</li>
                    </ul>
                    <p className="text-xs text-secondaryText">Note: Smart Provider Selection runs inside subscriber-core; this demo is an overview.</p>
                    <div className="flex gap-3 flex-wrap">
                    <button onClick={() => setShowHowItWorks(true)} className="bg-arkeo text-slate-900 font-semibold px-4 py-2.5 rounded-xl shadow-lg flex items-center gap-2 hover:brightness-110 transition-all">
                      <Icons.Wand /> Watch how Arkeo works
                    </button>
                    </div>
                  </div>
                  <div className="relative rounded-2xl overflow-hidden border border-[var(--border)] shadow-lg">
                    <div className="absolute inset-0 bg-[radial-gradient(circle_at_top_right,rgba(59,224,255,0.15),transparent_55%),radial-gradient(circle_at_bottom_left,rgba(59,224,255,0.15),transparent_55%)]" />
                    <div className="relative aspect-video">
                      <iframe
                        src="https://www.youtube.com/embed/nCgQDjiotG0?rel=0"
                        title="Arkeo Overview"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowFullScreen
                        loading="lazy"
                        className="absolute inset-0 w-full h-full"
                      />
                    </div>
                  </div>
                </div>
              </div>

            {/* Filters */}
            <div className="grid gap-3 lg:grid-cols-5 xl:grid-cols-6 mb-6">
              <div className="relative">
                <input type="text" placeholder="Search providers..." value={providerSearch} onChange={e => setProviderSearch(e.target.value)} className="w-full bg-[var(--surface)] border border-[var(--border)] rounded-xl pl-11 pr-4 py-3 text-white placeholder-secondaryText focus:border-primary focus:ring-1 focus:ring-primary" style={{ paddingLeft: '2.75rem' }} />
                <div className="absolute left-4 top-1/2 -translate-y-1/2 text-secondaryText"><Icons.Search /></div>
              </div>
              <DataServiceFilter selected={serviceFilter} onSelect={setServiceFilter} />
              <LocationFilter selectedRegion={regionFilter} onSelect={setRegionFilter} />
              <SimpleDropdown label="Time Range" selected={timeRange} options={TIME_RANGES} onChange={setTimeRange} />
              <SimpleDropdown label="Sort By" selected={sortBy} options={SORT_OPTIONS} onChange={setSortBy} />
              <label className="flex items-center gap-2 card-surface rounded-xl px-4 py-3 text-sm text-secondaryText cursor-pointer">
                <input type="checkbox" checked={showOffline} onChange={e => setShowOffline(e.target.checked)} className="form-checkbox h-4 w-4 text-arkeo rounded border-[var(--border)] bg-[var(--surface)]" />
                Show Offline
              </label>
            </div>

            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-5">
              {filteredProviders.map(provider => (
                <ProviderCard
                  key={provider.id}
                  provider={provider}
                  serviceFilter={serviceFilter}
                  onOpenContract={(p) => { setContractProvider(p); setShowContractModal(true); }}
                />
              ))}
            </div>

            {filteredProviders.length === 0 && (
              <div className="text-center py-16">
                <div className="w-16 h-16 bg-[var(--surface)] border border-[var(--border)] rounded-2xl flex items-center justify-center mx-auto mb-4 text-secondaryText"><Icons.Search /></div>
                <h3 className="text-lg font-semibold text-white mb-2">No providers found</h3>
                <p className="text-secondaryText">Try adjusting your search, chain, or location filter</p>
              </div>
            )}

            <div className="mt-8 card-surface rounded-2xl p-6 relative overflow-hidden">
              <div className="absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_top_right,rgba(59,224,255,0.2),transparent_50%),radial-gradient(circle_at_bottom_left,rgba(59,224,255,0.12),transparent_45%)]" />
              <div className="flex flex-col md:flex-row items-center gap-4">
                <ArkeoLogo size={48} />
                <div className="flex-1 text-center md:text-left relative z-10">
                  <h3 className="font-bold text-white mb-1">Get ARKEO on Osmosis</h3>
                  <p className="text-secondaryText text-sm">ARKEO tokens are available on Osmosis DEX.</p>
                </div>
                <a href="https://app.osmosis.zone/?from=USDC&to=ARKEO" target="_blank" className="px-6 py-3 bg-arkeo text-slate-900 font-semibold rounded-xl flex items-center gap-2 relative z-10 shadow-lg hover:brightness-110 transition-all">
                  Buy ARKEO <Icons.External />
                </a>
              </div>
            </div>

          </main>

          <BecomeProviderModal isOpen={showBecomeProvider} onClose={() => setShowBecomeProvider(false)} />
          <OpenContractModal provider={contractProvider} isOpen={showContractModal} onClose={() => setShowContractModal(false)} onSuccess={() => { showNotif('âœ“ Contract opened!'); setShowContractModal(false); }} />
          <HowItWorksModal isOpen={showHowItWorks} onClose={() => setShowHowItWorks(false)} />
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
