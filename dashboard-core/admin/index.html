<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Arkeo Data Marketplace | Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="images/favicon.ico">
    <link rel="shortcut icon" href="images/favicon.ico">
</head>
<body>
<div class="page">

    <div class="card header-card">
        <div class="header-brand-row">
            <img src="images/arkeo-logo-200px_1.png" alt="Arkeo" class="header-logo">
            <div class="header-brand">
                <span class="brand-main">Arkeo Data Marketplace</span>
                <span class="brand-sep">|</span>
                <span class="brand-sub">Dashboard</span>
            </div>
        </div>
        <h1>Dashboard Core</h1>
        <div class="header-desc muted">The Marketplace for Decentralized Data.</div>
    </div>

    <div class="card body-card"></div>

    <div class="card footer-card">
        <div class="footer-links">
            <div class="footer-brand">
                <img src="images/arkeo-logo-200px_1.png" alt="Arkeo" class="footer-logo">
                <span class="footer-title">
                    <span class="brand-main">Arkeo Marketplace</span>
                    <span class="brand-sep">|</span>
                    <span class="brand-sub">Dashboard</span>
                </span>
            </div>
            <div class="footer-links-right">
                <div><a href="https://arkeo.network/" target="_blank" rel="noopener">Arkeo Marketplace Website</a></div>
                <div><a href="https://discord.gg/arkeo" target="_blank" rel="noopener">Arkeo Discord</a></div>
            </div>
        </div>
    </div>

    <div class="card debug-card">
        <div class="debug-header">
            <h3>Debug Logs</h3>
            <button class="btn-ghost" onclick="refreshLogs()">Refresh</button>
        </div>
        <pre id="debugLogBox">(loading...)</pre>
    </div>

</div>
<script>
    const API_PORT_DEFAULT = 9996;
    const apiPort = new URLSearchParams(window.location.search).get("api_port") || window.API_PORT || API_PORT_DEFAULT;
    const API_BASE = `${window.location.protocol}//${window.location.hostname}${apiPort ? ":" + apiPort : ""}`;
    const apiUrl = (path) => `${API_BASE}${path}`;

    async function refreshLogs() {
        const box = document.getElementById("debugLogBox");
        box.textContent = "Loading logs...";
        try {
            const resp = await fetch(apiUrl("/api/logs"), { cache: "no-store" });
            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
            const data = await resp.json();
            const sections = [];
            Object.entries(data || {}).forEach(([name, payload]) => {
                if (!payload) return;
                const header = `>>> ${name} (${payload.path || "n/a"})`;
                const body = (payload.lines || []).join("\n");
                const trunc = payload.truncated ? "\n... (truncated)\n" : "";
                sections.push([header, body, trunc].join("\n"));
            });
            box.textContent = sections.length ? sections.join("\n\n") : "(no logs yet)";
        } catch (e) {
            box.textContent = `Failed to load logs: ${e}`;
        }
    }

    refreshLogs();
</script>
</body>
</html>
